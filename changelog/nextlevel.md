# Next-Level Engineering Roadmap

> Objective: Transform this repository from a robust academic setup toolkit into a production-grade, reproducible, observable, secure, and continuously validated engineering platform.

---
## Guiding Principles
- Deterministic: Same inputs -> same environment.
- Idempotent + Recoverable: Re-runs cause no harm; state changes tracked and reversible.
- Observable: Every major action emits structured telemetry (machine + human readable).
- Secure-by-Default: Integrity verification, least-privilege, minimized supply-chain risk.
- Profiled: Tailored installation depth (minimal / standard / full / ci).
- Extensible: Pluggable modules with clear contracts (inputs/outputs, exit semantics).
- Documented from Source: Docs generated from canonical machine-readable manifests.

---
## Phase Overview (Sequential, Overlapping Allowed)
| Phase | Theme | Core Outcomes |
|-------|-------|--------------|
| 1 | Version Pinning & Manifests | versions.yaml, resolver, pin enforcement, generated tools matrix |
| 2 | CI & Automated Validation | GitHub Actions pipelines, smoke containers, shell lint gates |
| 3 | Security & Integrity | Checksum/GPG verification, SBOM, artifact allowlist, curl minimization |
| 4 | State, Rollback, Offline | Change ledger, rollback script, cache/prefetch layer, offline mode |
| 5 | Observability & Metrics | Structured logs, timing, resource usage, verification JSON export |
| 6 | Profiles & Modularity | --profile flags, task graph executor, plugin hooks |
| 7 | Performance & Parallelism | Batched installs, concurrency where safe, profiling reports |
| 8 | UX & Teaching Aids | Guided TUI, remediation suggestions, docs generation automation |
| 9 | Hardening & Drift Control | Drift detector CI job, auto-diff doc generator, stale pin alerts |
| 10 | Polishing & Ecosystem | Container images, SBOM diffing, release tagging, upgrade assistant |

---
## Detailed Deliverables by Phase
### Phase 1: Version Pinning & Manifests
Deliverables:
- `manifests/versions.yaml` (schema below)
- `scripts/utils/version-resolver.sh` (shell API: load_versions, get_version <key>)
- Replacement of ad-hoc `pip install X` with pinned spec sets aggregated into grouped install calls.
- Autogenerated `TOOLS_MATRIX.md` + injection section in `README.md` via `scripts/tools/generate-docs.sh`.
- Validation script `scripts/validation/verify-pins.sh` ensuring no unpinned critical installs remain.

versions.yaml schema (draft):
```yaml
schema_version: 1
python:
  required: ["3.11.7"]
  packages:
    core:
      numpy: "1.26.*"
      pandas: "2.2.*"
      matplotlib: "3.8.*"
    ml:
      torch: "2.2.*"
      torchvision: "0.17.*"
      tensorflow: { selector: "gpu|cpu", versions: { cpu: "2.16.*", gpu: "2.16.*" } }
node:
  runtime: "20.11.*"
  globals:
    - name: typescript
      version: "5.4.*"
    - name: yarn
      version: "1.22.*"
    - name: pnpm
      version: "8.15.*"
linux:
  apt:
    base:
      - build-essential=12.9ubuntu3
      - cmake=3.28.*
    db:
      - postgresql=16*
      - redis-server=7.0*
macos:
  brew:
    base:
      - cmake@3.28
      - jq
profiles:
  minimal:
    python.packages: ["core"]
  full:
    python.packages: ["core","ml"]
```

Acceptance Criteria:
- Running `generate-docs.sh` produces stable matrix diff only when versions.yaml changes.
- Scripts fail fast if resolver cannot map a requested component.

### Phase 2: CI & Automated Validation
Deliverables:
- `.github/workflows/ci.yml` with jobs:
  - lint (shellcheck, markdownlint)
  - static pin audit (verify-pins.sh)
  - smoke (ubuntu-latest, macos-latest): run minimal profile setups + verifications (timeouts enforced)
- Artifact upload: verification JSON summaries.
- Badge generation for README (Pass/Fail status link).
Acceptance Criteria:
- PR blocked unless all jobs succeed.
- CI runtime target: < 15m for full matrix (stretch: < 10m after Phase 7).

### Phase 3: Security & Integrity
Deliverables:
- `scripts/security/checksums.sh` with `verify_download <url> <sha256>`.
- Manifest extension: `sources:` block with URL + SHA256.
- SBOM generation: `scripts/security/generate-sbom.sh` (CycloneDX for pip/npm + manual system list) → `sbom/`.
- LICENSE aggregation script: detect distinct licenses, output `THIRD_PARTY_LICENSES.md`.
- Ban `curl | bash` patterns; enforce detached download + verify + execute.
Acceptance Criteria:
- CI fails if any source referenced without checksum.
- SBOM diff job highlights new components.

### Phase 4: State, Rollback, Offline
Deliverables:
- `state/ledger.json` incremental append (JSON lines) with operation, timestamp, tool, action, success.
- `scripts/state/rollback.sh` stub (Phase 4 implements uninstall for subset: npm -g, pip user packages, simple apt/brew leaves; Phase 8 expands).
- Prefetch: `scripts/cache/prefetch.sh --profile full` populates `cache/` (wheels, npm tarballs, brew bundle).
- Offline mode flag `--offline` uses only cached artifacts; fails with actionable message if missing.
Acceptance Criteria:
- Killing a script mid-run leaves ledger consistent (use atomic append).
- Re-running with `--offline` works after a successful prefetch (no network calls observable in logs).

### Phase 5: Observability & Metrics
Deliverables:
- Structured JSON log emitter `scripts/utils/log-json.sh` (fields: ts, phase, action, duration_ms, status, error?).
- Wrap major phases with timing; write to `logs/last-run.jsonl` + optional `--log-dir` override.
- Verification summary gains `--output-json <file>` with PASS/FAIL list.
- Metrics aggregator `scripts/metrics/summarize.sh` outputs durations histogram + slowest 10 steps.
Acceptance Criteria:
- CI artifact includes metrics summary.
- All installs > outlier threshold flagged.

### Phase 6: Profiles & Modularity
Deliverables:
- Unified argument parsing library `scripts/utils/argparse.sh`.
- Profile dispatch table; each course script defers component selection to `profile_resolve <domain> <profile>`.
- Plugin system: `plugins/` directory; any `*.sh` with `plugin_register` function auto-sourced when `--enable-plugins` used.
Acceptance Criteria:
- Minimal profile reduces ML install (no heavy frameworks) & web (no Angular/Vue) while still verifying core.
- Adding a plugin file requires no changes to core scripts.

### Phase 7: Performance & Parallelism
Deliverables:
- Batching: consolidate pip installs per category (single invocation per group), apt multi-package lines, parallel safe groups via subshell + wait.
- Profiling mode `--profile-performance` prints concurrency graph & critical path.
- Caching improvements: pip wheel build reuse, Node `corepack enable` + deterministic installs.
Acceptance Criteria:
- Measured wall-clock reduction ≥ 25% vs Phase 1 baseline (documented in metrics history).

### Phase 8: UX & Teaching Aids
Deliverables:
- Interactive TUI (`gum` or fallback to plain prompts) for selecting profiles & optional components.
- Remediation generator: after verification failures, produce targeted install commands.
- `docs/generated/*.md` updated automatically (no manual edits in README sections between markers).
Acceptance Criteria:
- Choosing components interactively writes a reproducible invocation file (re-run later) e.g., `replay.sh`.

### Phase 9: Hardening & Drift Control
Deliverables:
- Drift detector: compares current system tool versions vs pinned; outputs actionable diff.
- Scheduled CI workflow (cron) that alerts on upstream version disappearance (e.g., brew formula rename) or security advisories (placeholder feed integration).
Acceptance Criteria:
- PR blocked if drift detector finds undocumented deltas.

### Phase 10: Polishing & Ecosystem
Deliverables:
- Official container images: `ghcr.io/<org>/dev-env:{minimal,full}` built from pinned manifests.
- Release automation: tag + changelog generation from ledger + commit conventional tags.
- Upgrade assistant: `scripts/upgrade/apply-migrations.sh` updates older clones to new manifest style.
Acceptance Criteria:
- Cutting a release requires only updating versions.yaml and running a single release script.

---
## Cross-Cutting Schemas
### Ledger Entry
```json
{
  "ts": "2025-09-15T12:34:56Z",
  "script": "setup-ml.sh",
  "action": "pip_install",
  "component": "numpy",
  "version": "1.26.2",
  "status": "success",
  "duration_ms": 3120,
  "profile": "full"
}
```

### Structured Log Event
```json
{
  "ts": "2025-09-15T12:35:02Z",
  "phase": "ml:tensorflow",
  "event": "install_start",
  "profile": "full",
  "attempt": 1
}
```

### Verification JSON Output
```json
{
  "script": "setup-database.sh",
  "profile": "full",
  "timestamp": "2025-09-15T12:40:00Z",
  "pass": ["psql","mysql","mongod","redis-server"],
  "fail": ["mysql_service"],
  "warn": ["mariadb_service"],
  "ports": {"5432": true, "3306": false}
}
```

---
## Task Matrix (Initial Population)
| ID | Phase | Category | Task | File(s) / Artifact | Est | Criticality |
|----|-------|----------|------|--------------------|-----|-------------|
| P1-1 | 1 | Manifest | Create `manifests/versions.yaml` | manifests/versions.yaml | 2h | High |
| P1-2 | 1 | Resolver | Implement `version-resolver.sh` | scripts/utils/version-resolver.sh | 3h | High |
| P1-3 | 1 | Refactor | Replace inline installs with resolver calls (db/web/ml/systems/mobile) | scripts/courses/*.sh | 1d | High |
| P1-4 | 1 | Docs | Doc generator + matrix injection | scripts/tools/generate-docs.sh | 4h | Medium |
| P1-5 | 1 | Guard | Pin audit script | scripts/validation/verify-pins.sh | 2h | High |
| P2-1 | 2 | CI | Add workflow (lint + smoke matrix) | .github/workflows/ci.yml | 3h | High |
| P2-2 | 2 | CI | Shellcheck + markdownlint config | .shellcheckrc, .markdownlint.json | 1h | Medium |
| P2-3 | 2 | CI | Upload verification artifacts | ci workflow | 1h | Medium |
| P3-1 | 3 | Security | checksums lib | scripts/security/checksums.sh | 2h | High |
| P3-2 | 3 | Security | Extend manifest (sources block + validation) | manifests/versions.yaml | 2h | High |
| P3-3 | 3 | Security | SBOM generation script | scripts/security/generate-sbom.sh | 4h | Medium |
| P3-4 | 3 | Security | Third-party license aggregator | scripts/security/licenses.sh | 3h | Medium |
| P4-1 | 4 | State | Ledger writer | scripts/state/ledger.sh | 3h | High |
| P4-2 | 4 | State | Rollback prototype | scripts/state/rollback.sh | 4h | Medium |
| P4-3 | 4 | Cache | Prefetch script | scripts/cache/prefetch.sh | 4h | High |
| P4-4 | 4 | Cache | Offline mode integration | shared scripts | 1d | High |
| P5-1 | 5 | Logs | JSON log emitter | scripts/utils/log-json.sh | 2h | High |
| P5-2 | 5 | Metrics | Summarize script | scripts/metrics/summarize.sh | 3h | Medium |
| P5-3 | 5 | Verify | Add --output-json to verification | scripts/utils/verify.sh | 1h | High |
| P6-1 | 6 | Profiles | argparse lib | scripts/utils/argparse.sh | 3h | High |
| P6-2 | 6 | Profiles | Profile resolution engine | scripts/utils/profile-resolver.sh | 4h | High |
| P6-3 | 6 | Profiles | Script integration | course scripts | 1d | High |
| P6-4 | 6 | Plugins | Plugin loader | scripts/utils/plugins.sh | 3h | Medium |
| P7-1 | 7 | Perf | Batch pip installs | course scripts | 4h | High |
| P7-2 | 7 | Perf | Parallel safe groups | course scripts | 6h | Medium |
| P7-3 | 7 | Perf | Performance profiling mode | scripts/utils/perf-profile.sh | 4h | Medium |
| P8-1 | 8 | UX | TUI selector | scripts/ux/select-profile.sh | 5h | Medium |
| P8-2 | 8 | UX | Remediation generator | scripts/ux/remediate.sh | 4h | Medium |
| P8-3 | 8 | Docs | Autogen section markers | generate-docs.sh | 2h | Medium |
| P9-1 | 9 | Drift | Drift detector | scripts/validation/drift-detect.sh | 4h | High |
| P9-2 | 9 | Drift | Scheduled workflow | .github/workflows/drift.yml | 1h | High |
| P10-1 | 10 | Release | Container Dockerfiles | docker/* | 1d | Medium |
| P10-2 | 10 | Release | Release automation script | scripts/release/create-release.sh | 4h | Medium |
| P10-3 | 10 | Release | Upgrade assistant | scripts/upgrade/apply-migrations.sh | 1d | Medium |

---
## Risk Register
| Risk | Impact | Mitigation |
|------|--------|------------|
| Upstream version removal | Breaks builds | Scheduled drift CI + mirrors |
| GPU lib conflicts | ML installs fail | Profile gating + isolated venv per heavy stack |
| Checksum rot (updated upstream tarballs) | False failure | Allow explicit rebaseline command |
| Parallel apt causing lock contention | Script abort | Detect apt lock; serialize critical phases |
| Offline cache staleness | Inconsistent env | Embed manifest hash in cache metadata |
| Plugin execution trust | Supply-chain risk | Signed plugin mode / allowlist directory |

---
## Acceptance Gate per Phase
- All deliverables merged + CI green
- Documentation updated/generated
- Metrics & validation evidence committed under `changelog/progress/`

---
## Initial Execution Order (Actionable Sprint Plan)
1. P1-1 → P1-2 → P1-5 (skeleton) to establish enforcement early.
2. P1-3 refactor incrementally per course script (commit per domain).
3. P1-4 finalize doc gen once refactors stabilize.
4. Move to Phase 2 CI gates immediately after first manifest-driven script lands.

---
## Next Immediate Step
Create `manifests/versions.yaml` + skeleton resolver + pin audit script (stubs) to anchor further work.

---
## Tracking & Progress
Progress snapshots appended here with timestamped mini-sections as work proceeds.

```
[2025-09-15T00:00Z] Roadmap initialized.
[2025-09-15T00:10Z] Phase 1 scaffolds created: manifests/versions.yaml, version-resolver skeleton, pin audit stub.
[2025-09-15T00:40Z] Manifest expanded with ML/Viz/NLP/CV groups + node globals; added data-science profile.
[2025-09-15T00:55Z] Resolver enhanced for dot-notation categories (extras.*) and nested group parsing.
[2025-09-15T01:10Z] Web development script refactored to manifest-driven global installs (removed ad-hoc extras loop).
[2025-09-15T01:25Z] Documentation generator script created (generate-docs.sh) and README markers inserted.
[2025-09-15T01:35Z] Pin audit script updated to tolerate resolver-driven variable installs; initial clean pass.
[2025-09-15T02:05Z] Added python web/db groups + mobile/web devtool node globals to manifest.
[2025-09-15T02:15Z] Refactored webdev & database scripts to resolver-driven pip installs (web/db groups).
[2025-09-15T02:25Z] Mobile script updated to manifest-driven global installs for RN/Expo/Appium/Detox.
[2025-09-15T02:30Z] Pin audit refined to whitelist new resolver patterns; docs matrix regenerated.
[2025-09-15T02:40Z] Refactored setup-eclipse with shared utils, safety flags, idempotent download.
[2025-09-15T02:45Z] Refactored setup-vscode with shared utils, idempotent extension installs.
[2025-09-15T03:05Z] Phase 2 CI expansion: added markdownlint config, docs consistency & smoke scripts, expanded workflow with matrix (ubuntu/macos) and artifacts, README badges inserted.
```
